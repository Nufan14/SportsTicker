<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <style>
        body { background: #050505; font-family: 'Segoe UI', sans-serif; margin: 0; padding: 10px; color: #eee; overflow: hidden; }
        .header { 
            background: linear-gradient(135deg, #1a237e, #4a148c); 
            color: white; padding: 12px; text-align: center; border-radius: 6px; 
            font-weight: 800; text-transform: uppercase; letter-spacing: 2px; margin-bottom: 10px;
            border: 1px solid #3949ab;
        }
        #content { display: flex; flex-direction: column; gap: 6px; }
        .row { 
            background: rgba(25, 25, 25, 0.9); display: flex; align-items: center; padding: 8px 15px; 
            border-radius: 6px; border-left: 4px solid #3949ab; height: 42px;
        }
        .label { width: 85px; font-size: 0.65rem; color: #aaa; font-weight: bold; text-transform: uppercase; }
        .status { width: 100px; font-size: 0.7rem; color: #00e676; font-weight: bold; }
        .match { flex: 1; display: flex; align-items: center; justify-content: space-between; gap: 10px; }
        .tm { display: flex; align-items: center; gap: 8px; flex: 1; font-size: 0.9rem; font-weight: 600; }
        .tm.h { justify-content: flex-end; text-align: right; }
        .tm.a { justify-content: flex-start; text-align: left; }
        .score { 
            background: #1a1a1a; padding: 3px 10px; border-radius: 15px; min-width: 60px; 
            text-align: center; font-weight: 800; color: #ffeb3b; border: 1px solid #444;
        }
        img.logo { width: 24px; height: 24px; object-fit: contain; }
    </style>
</head>
<body>
    <div class="header">‚≠ê MAIN EVENTS: TODAY & UPCOMING</div>
    <div id="content"></div>

    <script>
        async function getStats() {
            const list = document.getElementById('content');
            const sources = [
                { n: 'Tennis', u: 'https://site.api.espn.com/apis/site/v2/sports/tennis/atp/scoreboard' },
                { n: 'Tennis', u: 'https://site.api.espn.com/apis/site/v2/sports/tennis/wta/scoreboard' },
                { n: 'NCAA BK', u: 'https://site.api.espn.com/apis/site/v2/sports/basketball/mens-college-basketball/scoreboard?groups=80' },
                { n: 'Golf', u: 'https://site.api.espn.com/apis/site/v2/sports/golf/pga/scoreboard' },
                { n: 'UFC/MMA', u: 'https://site.api.espn.com/apis/site/v2/sports/mma/ufc/scoreboard' },
                { n: 'Boxing', u: 'https://site.api.espn.com/apis/site/v2/sports/boxing/scoreboard' },
                { n: 'F1', u: 'https://site.api.espn.com/apis/site/v2/sports/racing/f1/scoreboard' },
                { n: 'MLB', u: 'https://site.api.espn.com/apis/site/v2/sports/baseball/mlb/scoreboard' }
            ];

            let results = [];

            for (let s of sources) {
                try {
                    const res = await fetch(`${s.u}?cb=${Date.now()}`);
                    const data = await res.json();
                    if (data.events) {
                        // Take top 3 events from every category to ensure the list is full
                        data.events.slice(0, 3).forEach(e => {
                            const state = e.status.type.state;
                            // Filter out Spring Training MLB unless it's currently live
                            if (s.n === 'MLB' && e.season.type !== 2 && state !== 'in') return;
                            
                            results.push({ s: s.n, e: e, date: new Date(e.date) });
                        });
                    }
                } catch (err) { console.log("Missing: " + s.n); }
            }

            // SORT: Show games happening NOW first, then games starting SOONEST
            results.sort((a, b) => {
                if (a.e.status.type.state === 'in' && b.e.status.type.state !== 'in') return -1;
                if (a.e.status.type.state !== 'in' && b.e.status.type.state === 'in') return 1;
                return a.date - b.date;
            });

            list.innerHTML = results.slice(0, 10).map(item => {
                const e = item.e;
                const stat = e.status.type;
                const tms = e.competitions[0].competitors;
                const h = tms.find(t => t.homeAway === 'home') || tms[0];
                const a = tms.find(t => t.homeAway === 'away') || tms[1];

                return `
                    <div class="row">
                        <div class="label">${item.s}</div>
                        <div class="status" style="color: ${stat.state === 'in' ? '#ff5252' : '#00e676'}">
                            ${stat.shortDetail}
                        </div>
                        <div class="match">
                            <div class="tm h"><span>${h.team.name}</span><img src="${h.team.logo || ''}" class="logo"></div>
                            <div class="score">${stat.state === 'pre' ? 'VS' : h.score + '-' + a.score}</div>
                            <div class="tm a"><img src="${a.team.logo || ''}" class="logo"><span>${a.team.name}</span></div>
                        </div>
                    </div>`;
            }).join('');
        }
        getStats();
        setInterval(getStats, 60000);
    </script>
</body>
</html>
